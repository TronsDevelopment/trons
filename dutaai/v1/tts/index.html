<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DutaAI - TTS</title>

  <script src="https://cdn.jsdelivr.net/npm/bytez.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            bg: '#0b1020',
            card: '#111827',
            accent: '#7c3aed',
            muted: '#9aa4b2',
          },
        },
      },
    };
  </script>

  <style>
    select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-color: transparent;
      background-image: url("data:image/svg+xml,%3Csvg fill='none' stroke='%239aa4b2' stroke-width='2' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E<path stroke-linecap='round' stroke-linejoin='round' d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.8rem center;
      background-size: 1rem;
      border: 1px solid #374151;
      border-radius: 0.5rem;
      padding: 0.5rem 2rem 0.5rem 0.75rem;
      font-size: 0.9rem;
      color: #e5e7eb;
      width: 100%;
    }

    select:focus {
      outline: none;
      border-color: #7c3aed;
      box-shadow: 0 0 0 2px #7c3aed55;
      transition: 0.2s;
    }

    option {
      background-color: #111827;
      color: #e5e7eb;
    }

    @keyframes fadeOut {
      0% { opacity: 1; transform: scale(1); }
      80% { opacity: 0; transform: scale(1.05); }
      100% { opacity: 0; visibility: hidden; }
    }

    @keyframes fadeText {
      0% { opacity: 0; letter-spacing: 0.5em; filter: blur(8px); }
      50% { opacity: 1; letter-spacing: 0.3em; filter: blur(2px); }
      100% { opacity: 1; letter-spacing: 0.25em; filter: blur(0); }
    }

    .animate-fade {
      animation: fadeText 1.5s ease-out forwards;
    }
  </style>
</head>

<body class="bg-bg text-gray-100 min-h-screen flex items-center justify-center p-6">

  <div id="loadingScreen" class="fixed inset-0 bg-[#0b1020] flex flex-col items-center justify-center z-50">
    <h1 class="text-4xl md:text-5xl font-bold text-white tracking-[0.25em] animate-fade">
      Duta<span class="text-violet-500">AI</span>
    </h1>
    <p id="loadingVersion" class="text-violet-400/80 text-xs mt-3 opacity-0 transition-opacity duration-700">versi v1.3</p>
  </div>

  <div class="max-w-2xl w-full">
  <header class="mb-6 text-center">
    <h1 class="text-2xl font-bold mb-1">DutaAI - TTS</h1>
    <p class="text-violet-400 text-xs font-semibold">versi v1.2</p>
    <p class="text-muted text-sm mt-1">TTS Bahasa Indonesia ringan & gratis.</p>
  </header>

    <section class="bg-card rounded-2xl shadow-2xl p-6 border border-gray-800">
      <label for="text" class="block font-semibold mb-2">Masukkan teks Bahasa Indonesia</label>
      <textarea id="text"
        class="w-full rounded-xl bg-transparent border border-gray-700 focus:border-accent focus:ring-accent p-3 text-sm h-36 resize-none"
        placeholder="Ketik atau tempel teks di sini...">Halo! Selamat pagi atau malam, ganti bagian ini dan masukkan teks kamu!</textarea>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-5">
        <div>
          <label class="block font-medium mb-1">Mode TTS</label>
          <select id="ttsMode" class="w-full bg-transparent border border-gray-700 rounded-lg p-2 text-sm focus:border-accent focus:ring-accent">
            <option value="browser">Browser (Web Speech)</option>
            <option value="streamelements">StreamElements</option>
            <option value="bytez-cdn">Bytez (CDN)</option>
            <option value="bytez-run">Bytez (Run API)</option>
          </select>

          <!-- Browser Section -->
          <div id="browserSection" class="mt-4">
            <label class="block font-medium mb-1">Pilih Voice (Browser)</label>
            <select id="voices" class="w-full bg-transparent border border-gray-700 rounded-lg p-2 text-sm focus:border-accent focus:ring-accent"></select>
            <div id="voiceInfo" class="max-h-32 overflow-y-auto mt-3 p-3 text-xs border border-dashed border-gray-700 rounded-lg text-muted"></div>
          </div>

          <!-- StreamElements Section -->
          <div id="seSection" class="hidden mt-4">
            <label class="block font-medium mb-1">Pilih Voice (StreamElements)</label>
            <select id="seVoices" class="w-full bg-transparent border border-gray-700 rounded-lg p-2 text-sm focus:border-accent focus:ring-accent">
              <option value="id-ID-Wavenet-A">id-ID-Wavenet-A (Perempuan)</option>
              <option value="id-ID-Wavenet-B">id-ID-Wavenet-B (Laki-laki)</option>
              <option value="id-ID-Wavenet-C">id-ID-Wavenet-C (Natural)</option>
            </select>
            <div id="seVoiceInfo" class="max-h-32 overflow-y-auto mt-3 p-3 text-xs border border-dashed border-gray-700 rounded-lg text-muted"></div>
          </div>

          <!-- Bytez CDN Section -->
          <div id="bytezCdnSection" class="hidden mt-4 text-xs text-muted border border-dashed border-gray-700 rounded-lg p-3">
            <p><strong>Bytez CDN</strong> memakai jaringan CDN Bytez untuk hasil cepat tanpa setup tambahan.<br>
            ‚ö° <em>Pro:</em> cepat & ringan<br>
            üß± <em>Con:</em> kadang delay suara 1‚Äì2 detik.</p>
          </div>

          <!-- Bytez Run Section -->
          <div id="bytezRunSection" class="hidden mt-4 text-xs text-muted border border-dashed border-gray-700 rounded-lg p-3">
            <p><strong>Bytez Run API</strong> menjalankan model langsung via API Bytez ‚Äî hasil lebih stabil & konsisten.<br>
            ‚ö° <em>Pro:</em> kontrol penuh hasil<br>
            üß± <em>Con:</em> sedikit lebih lambat dari CDN.</p>
          </div>
        </div>

        <div>
          <label class="block font-medium mb-1">Pitch <small id="pitchVal" class="text-muted">1</small></label>
          <input id="pitch" type="range" min="0" max="2" step="0.1" value="1" class="w-full accent-accent">
          <label class="block font-medium mt-3 mb-1">Kecepatan <small id="rateVal" class="text-muted">1</small></label>
          <input id="rate" type="range" min="0.5" max="2" step="0.1" value="1" class="w-full accent-accent">
        </div>
      </div>

      <div class="flex flex-wrap gap-3 mt-6">
        <button id="speak" class="flex-1 bg-accent hover:bg-violet-600 transition font-semibold py-2 rounded-xl">‚ñ∂Ô∏è Bicara</button>
        <button id="pause" class="flex-1 bg-gray-700 hover:bg-gray-600 transition font-semibold py-2 rounded-xl">‚è∏Ô∏è Jeda</button>
        <button id="resume" class="flex-1 bg-gray-700 hover:bg-gray-600 transition font-semibold py-2 rounded-xl">‚ñ∂Ô∏è Lanjut</button>
        <button id="cancel" class="flex-1 bg-red-700 hover:bg-red-600 transition font-semibold py-2 rounded-xl">‚úñÔ∏è Berhenti</button>
      </div>

      <p class="text-muted text-xs mt-5 text-center">
        Untuk sekarang, support:
        <br><code>Chrome/Edge</code> untuk Browser TTS, atau <code>StreamElements / Bytez API</code> untuk universal playback.
      </p>
    </section>
  </div>

  <script>
    const synth = window.speechSynthesis;
    const textEl = document.getElementById('text');
    const voicesSelect = document.getElementById('voices');
    const pitch = document.getElementById('pitch');
    const rate = document.getElementById('rate');
    const pitchVal = document.getElementById('pitchVal');
    const rateVal = document.getElementById('rateVal');
    const voiceInfo = document.getElementById('voiceInfo');
    const ttsMode = document.getElementById('ttsMode');
    const seVoices = document.getElementById('seVoices');
    const seVoiceInfo = document.getElementById('seVoiceInfo');
    let voices = [];

    const BYTEZ_KEY = "7d2e0b1635bea99b4ef9778cd1c0201e";

    async function playBytezCDN(text) {
      const sdk = new Bytez(BYTEZ_KEY);
      const model = sdk.model("facebook/mms-tts-ind");
      const { error, output } = await model.run(text, { json: false });
      if (error) return alert(error);
      const blob = new Blob([output]);
      new Audio(URL.createObjectURL(blob)).play();
    }

    async function playBytezRun(text) {
      const res = await fetch("https://api.bytez.com/run", {
        method: "POST",
        headers: {
          "Authorization": `Key ${BYTEZ_KEY}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: "facebook/mms-tts-ind",
          input: text,
          json: false
        })
      });
      const blob = await res.blob();
      new Audio(URL.createObjectURL(blob)).play();
    }

    function populateVoices() {
      const allVoices = synth.getVoices();
      voices = allVoices.filter(v => /^id(-[A-Z]+)?$/i.test(v.lang));
      voicesSelect.innerHTML = '';

      if (voices.length === 0) {
        voicesSelect.innerHTML = '<option value="-1">‚ùå Tidak ada voice Bahasa Indonesia</option>';
        voiceInfo.innerHTML = 'Browser kamu belum punya voice Bahasa Indonesia.<br>Coba pakai Chrome/Edge terbaru.';
        return;
      }

      voices.forEach((v, i) => {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = `${v.name} ‚Äî ${v.lang}`;
        voicesSelect.appendChild(opt);
      });
      updateVoiceInfo(voices[0]);
    }

    function updateVoiceInfo(v) {
      voiceInfo.innerHTML = `<strong>${v.name}</strong><br>Locale: ${v.lang}<br>URI: ${v.voiceURI || '‚Äî'}`;
    }

    synth.onvoiceschanged = populateVoices;

    voicesSelect.addEventListener('change', () => {
      const v = voices[parseInt(voicesSelect.value)];
      if (v) updateVoiceInfo(v);
    });

    const seVoiceData = {
      "id-ID-Wavenet-A": { name: "Wavenet A", gender: "Perempuan", tone: "Ceria dan ramah, cocok buat konten santai." },
      "id-ID-Wavenet-B": { name: "Wavenet B", gender: "Laki-laki", tone: "Tegas dan formal, cocok buat narasi." },
      "id-ID-Wavenet-C": { name: "Wavenet C", gender: "Netral", tone: "Natural dan seimbang, cocok buat video AI." }
    };

    function updateSEVoiceInfo(id) {
      const v = seVoiceData[id];
      if (v) seVoiceInfo.innerHTML = `<strong>${v.name}</strong><br>Gender: ${v.gender}<br>Karakter: ${v.tone}`;
    }

    seVoices.addEventListener('change', () => updateSEVoiceInfo(seVoices.value));
    updateSEVoiceInfo(seVoices.value);

    pitch.addEventListener('input', () => pitchVal.textContent = pitch.value);
    rate.addEventListener('input', () => rateVal.textContent = rate.value);

    async function playStreamElementsTTS(text, voice) {
      const url = `https://api.streamelements.com/kappa/v2/speech?voice=${voice}&text=${encodeURIComponent(text)}`;
      const audio = new Audio(url);
      try {
        await audio.play();
      } catch {
        alert("Gagal memutar audio. Browser kamu mungkin blokir autoplay.");
      }
    }

    function toggleSections(mode) {
      const ids = ["browserSection", "seSection", "bytezCdnSection", "bytezRunSection"];
      ids.forEach(id => document.getElementById(id).classList.add("hidden"));
      if (mode === "browser") document.getElementById("browserSection").classList.remove("hidden");
      if (mode === "streamelements") document.getElementById("seSection").classList.remove("hidden");
      if (mode === "bytez-cdn") document.getElementById("bytezCdnSection").classList.remove("hidden");
      if (mode === "bytez-run") document.getElementById("bytezRunSection").classList.remove("hidden");
    }

    ttsMode.addEventListener('change', () => toggleSections(ttsMode.value));

    function speak() {
      const mode = ttsMode.value;
      const text = textEl.value.trim();
      if (!text) return alert("Masukkan teks dulu!");

      if (mode === 'browser') {
        if (synth.speaking) return console.warn('Masih berbicara...');
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'id-ID';
        const selected = voices[parseInt(voicesSelect.value)];
        if (selected) utter.voice = selected;
        utter.pitch = parseFloat(pitch.value);
        utter.rate = parseFloat(rate.value);
        synth.speak(utter);
      } else if (mode === 'streamelements') {
        playStreamElementsTTS(text, seVoices.value);
      } else if (mode === 'bytez-cdn') {
        playBytezCDN(text);
      } else if (mode === 'bytez-run') {
        playBytezRun(text);
      }
    }

    document.getElementById('speak').onclick = speak;
    document.getElementById('pause').onclick = () => synth.pause();
    document.getElementById('resume').onclick = () => synth.resume();
    document.getElementById('cancel').onclick = () => synth.cancel();

    setTimeout(populateVoices, 200);

    const APP_VERSION = "v1.2";
    document.getElementById("loadingVersion").textContent = `versi ${APP_VERSION}`;

    window.addEventListener('load', () => {
      const loader = document.getElementById('loadingScreen');
      const versionEl = document.getElementById('loadingVersion');
      setTimeout(() => versionEl.style.opacity = '1', 700); // muncul setelah logo
      setTimeout(() => {
        loader.style.animation = 'fadeOut 0.8s ease forwards';
        setTimeout(() => loader.remove(), 600);
      }, 2000);
    });
  </script>
</body>
</html>
